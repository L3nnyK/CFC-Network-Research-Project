#~ Objective 
#Create a script that maps network devices for ports, services, and vulnerabilities.

#~ 1. Getting the user input
#~ The user enters the network range, and a new directory should be created.

function menu ()
{
#Initial selection menu.
#echo -e  \n for new line.

echo -e "\nPlease select the appropriate action by entering the corresponding number followed by ENTER."
echo -e "\n\e[0;32m1) To setup and initialise the system.\e[m \e[31m\n2) To conduct port and service scans.\e[m \n3) View/Access the log files. \n \n\e[1;35m0) Quit.\n\e[m"
read CHOICE1
echo -e "\nYou chose option $CHOICE1.\n"
case $CHOICE1 in

	1)
		echo "Starting system setup and initialisation. Please enter your sudo password where prompted."
		
		INST
		
	;;

	2)
		echo -e "\e[1;31mWelcome to the network scan menu.\n\e[m"
		
		SCAN
		
	;;

	3)	echo "View or access the log files."
		
		LOGIT
	;;

	0)	echo "Quit" 
			exit
	;;
	
	*)  echo "Invalid option!"
			menu
		;;
	
	esac
}	
	#1. Install relevant application on local computer.

function INST()
{
sudo apt-get update && sudo apt-get install -y searchsploit medusa hydra nmap masscan metasploit-framework 2>/dev/null

echo -e "\n "
#Run menu fucntion again to loop back. 
menu
}

#~ 2. Mapping ports and services
#~ The script scans and maps the network, saving information into the directory.
#~ Available tools: nmap, masscan

function SCAN()
{
echo -e "Before conducting scans or attacks please provide the requested inputs.\n"
	
read -rep $'Please provide a target IP range. \n\e[3m(e.g 192.168.153.0/24)\e[0m:' tgtIP
		
echo -e "\nYou have entered $tgtIP as ip range.\n"	

echo -e "[*] Mapping the range $tgtIP"

mkdir -v ${tgtIP%/*}

echo -e "[+] Directory created: ${tgtIP%/*}"

echo -e "\nPlease select the process you would like to start."

echo -e "\n\e[33m1) Conduct an masscan. \n2) Conduct a nmap scan.\e[0m \n \n\e[1;35m0)Quit.\n\e[m"

read CHOICE2
echo -e "\nYou chose option $CHOICE2.\n"

case $CHOICE2 in
1) 
		read -p "For masscan, you must specify a target port or port range. [hint] try something like -p80,443 or 0-65535. I suggest --top-ports 1000 for starters: " mstgtport
		echo -e "\nYou have specified $mstgtport as the target port or port range.\n"
	
	echo -e "\nConducting a masscan........\n"
	#Run nmap scan ans save the output to a file
			sudo masscan "$tgtIP" -p "$mstgtport",U:"$mstgtport" --rate 1000000 -oB ./${tgtIP%/*}/masscan_output -vv #remove -vv after testing
			
			masscan --readscan ./${tgtIP%/*}/masscan_output -oX ./${tgtIP%/*}/masscan_output.xml
			masscan --readscan ./${tgtIP%/*}/masscan_output -oG ./${tgtIP%/*}/masscan_output.grepable
			
	echo -e "\nScan outputs have been saved to the working directory ${tgtIP%/*} as masscan_output in binary format, masscan_output.xml and masscan_output.grepable \n"
		
		menu
		;;
		
2)
	echo -e "Conducting an nmap scan. \n "
	#Run nmap scan ans save the output to a file
			sudo nmap -p- -sV -O "$tgtIP" -oA ./${tgtIP%/*}/nmapscan_output
		
	echo -e "\n Scan outputs have been saved to the working directory ${tgtIP%/*} as nmapscan_output.nmap, nmapscan_output.xml and nmapscan_output \n"
		
		menu
		;;
		
0)	echo "Goodbye" 
				exit
		;;
	
*)  echo "Invalid option!"
		menu
		
		;;
			
esac
}

#~ 3. Mapping vulnerabilities
#~ The script will look for vulnerabilities using the nmap scripting engine,
#~ searchsploit, and finding weak passwords used in the network.
#~ Available tools: nmap, searchsploit, hydra, medusa



#~ 4. Displaying results
#~ At the end of the scan, show the user the general scanning statistics.

menu
